(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[931],{4529:function(e,s,t){Promise.resolve().then(t.bind(t,7879))},7879:function(e,s,t){"use strict";t.r(s),t.d(s,{default:function(){return h}});var a=t(3827),n=t(4090);function l(e){let{currentStep:s,steps:t}=e;return(0,a.jsx)("div",{className:"flex items-center justify-between",children:t.map((e,n)=>{let l=n+1,o=l===s,r=l<s;return(0,a.jsxs)("div",{className:"flex items-center flex-1",children:[(0,a.jsxs)("div",{className:"flex flex-col items-center flex-1",children:[(0,a.jsx)("div",{className:"\n                  w-10 h-10 rounded-full flex items-center justify-center font-semibold\n                  ".concat(o?"bg-blue-600 text-white":"","\n                  ").concat(r?"bg-green-500 text-white":"","\n                  ").concat(o||r?"":"bg-gray-300 text-gray-600","\n                "),children:r?"✓":l}),(0,a.jsx)("span",{className:"mt-2 text-sm font-medium text-gray-700",children:e})]}),n<t.length-1&&(0,a.jsx)("div",{className:"h-1 flex-1 mx-4 ".concat(r?"bg-green-500":"bg-gray-300")})]},l)})})}function o(e){let{state:s,onUpdate:t,onNext:l,sessionId:o}=e,[r,i]=(0,n.useState)({host:s.host||"",token:s.token||"",warehouse_id:s.warehouse_id||"",space_id:s.space_id||"",llm_endpoint:s.llm_endpoint||"databricks-gpt-5-2"}),[c,d]=(0,n.useState)([]),[h,u]=(0,n.useState)([]),[p,x]=(0,n.useState)(!1),[m,b]=(0,n.useState)(!1),[j,g]=(0,n.useState)("");(0,n.useEffect)(()=>{(async()=>{try{let e=await fetch("/api/workspace/config"),s=await e.json();(s.host||s.token)&&i(e=>({...e,host:s.host||e.host,token:s.token||e.token}))}catch(e){console.error("Failed to fetch default config:",e)}})()},[]),(0,n.useEffect)(()=>{if(!r.host||!r.token){d([]),u([]);return}let e=setTimeout(async()=>{g(""),x(!0);try{let e=await fetch("/api/workspace/warehouses",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({host:r.host,token:r.token})}),s=await e.json();s.error?(g("Warehouses: ".concat(s.error)),d([])):d(s.warehouses||[])}catch(e){g("Failed to fetch warehouses: ".concat(e)),d([])}finally{x(!1)}b(!0);try{let e=await fetch("/api/workspace/spaces",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({host:r.host,token:r.token})}),s=await e.json();s.error?(g(e=>e?"".concat(e," | Spaces: ").concat(s.error):"Spaces: ".concat(s.error)),u([])):u(s.spaces||[])}catch(e){g(s=>s?"".concat(s," | Failed to fetch spaces: ").concat(e):"Failed to fetch spaces: ".concat(e)),u([])}finally{b(!1)}},500);return()=>clearTimeout(e)},[r.host,r.token]);let y=r.host&&r.token&&r.warehouse_id&&r.space_id;return(0,a.jsxs)("div",{className:"space-y-6",children:[(0,a.jsx)("h2",{className:"text-2xl font-bold",children:"⚙️ Configure Workspace"}),(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium mb-2",children:"Databricks Host"}),(0,a.jsx)("input",{type:"text",value:r.host,onChange:e=>i({...r,host:e.target.value}),placeholder:"https://your-workspace.cloud.databricks.com",className:"w-full px-4 py-2 border rounded"}),r.host&&!r.host.startsWith("https://")&&(0,a.jsx)("p",{className:"text-sm text-amber-600 mt-1",children:"⚠️ Host should start with https://"})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium mb-2",children:"Access Token"}),(0,a.jsx)("input",{type:"password",value:r.token,onChange:e=>i({...r,token:e.target.value}),placeholder:"dapi...",className:"w-full px-4 py-2 border rounded"})]}),j&&(0,a.jsx)("div",{className:"p-3 bg-red-50 border border-red-200 rounded",children:(0,a.jsx)("p",{className:"text-sm text-red-600",children:j})}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium mb-2",children:"SQL Warehouse"}),p?(0,a.jsx)("div",{className:"text-sm text-gray-500 py-2",children:"Loading warehouses..."}):c.length>0?(0,a.jsxs)("select",{value:r.warehouse_id,onChange:e=>i({...r,warehouse_id:e.target.value}),className:"w-full px-4 py-2 border rounded",children:[(0,a.jsx)("option",{value:"",children:"Select a warehouse..."}),c.map(e=>(0,a.jsxs)("option",{value:e.id,children:[e.name," (",e.state,")"]},e.id))]}):r.host&&r.token?(0,a.jsx)("input",{type:"text",value:r.warehouse_id,onChange:e=>i({...r,warehouse_id:e.target.value}),placeholder:"Enter warehouse ID manually...",className:"w-full px-4 py-2 border rounded"}):(0,a.jsx)("input",{type:"text",value:r.warehouse_id,onChange:e=>i({...r,warehouse_id:e.target.value}),placeholder:"Enter host and token first...",className:"w-full px-4 py-2 border rounded bg-gray-50",disabled:!0})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium mb-2",children:"Genie Space"}),m?(0,a.jsx)("div",{className:"text-sm text-gray-500 py-2",children:"Loading spaces..."}):h.length>0?(0,a.jsxs)("select",{value:r.space_id,onChange:e=>i({...r,space_id:e.target.value}),className:"w-full px-4 py-2 border rounded",children:[(0,a.jsx)("option",{value:"",children:"Select a space..."}),h.map(e=>(0,a.jsxs)("option",{value:e.id,children:[e.name," (",e.id,")"]},e.id))]}):r.host&&r.token?(0,a.jsx)("input",{type:"text",value:r.space_id,onChange:e=>i({...r,space_id:e.target.value}),placeholder:"Enter space ID manually...",className:"w-full px-4 py-2 border rounded"}):(0,a.jsx)("input",{type:"text",value:r.space_id,onChange:e=>i({...r,space_id:e.target.value}),placeholder:"Enter host and token first...",className:"w-full px-4 py-2 border rounded bg-gray-50",disabled:!0})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium mb-2",children:"LLM Endpoint"}),(0,a.jsxs)("select",{value:r.llm_endpoint,onChange:e=>i({...r,llm_endpoint:e.target.value}),className:"w-full px-4 py-2 border rounded",children:[(0,a.jsx)("option",{value:"databricks-gpt-5-2",children:"databricks-gpt-5-2"}),(0,a.jsx)("option",{value:"databricks-gpt-4-turbo",children:"databricks-gpt-4-turbo"})]})]})]}),(0,a.jsx)("div",{className:"flex justify-end",children:(0,a.jsx)("button",{onClick:()=>{t(r),l()},disabled:!y,className:"bg-blue-600 text-white px-6 py-2 rounded hover:bg-blue-700 disabled:bg-gray-400",children:"Next →"})})]})}function r(e){let{state:s,onUpdate:t,onNext:l,onBack:o,sessionId:r}=e,[i,c]=(0,n.useState)(null),[d,h]=(0,n.useState)(!1),[u,p]=(0,n.useState)(null),x=async()=>{h(!0);try{let e=await fetch("/api/jobs/score",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({session_id:r,workspace_config:{host:s.host,token:s.token,warehouse_id:s.warehouse_id,space_id:s.space_id,llm_endpoint:s.llm_endpoint},benchmarks:s.benchmarks||[]})}),t=await e.json();c(t.job_id),m(t.job_id)}catch(e){console.error("Failed to start scoring:",e),h(!1)}},m=async e=>{let s=setInterval(async()=>{let a=await fetch("/api/jobs/".concat(e)),n=await a.json();"completed"===n.status?(clearInterval(s),p(n.result),h(!1),t({scoreResult:n.result})):"failed"===n.status&&(clearInterval(s),h(!1),alert("Scoring failed: "+n.error))},2e3)};return(0,a.jsxs)("div",{className:"space-y-6",children:[(0,a.jsx)("h2",{className:"text-2xl font-bold",children:"\uD83D\uDCCA Score Benchmarks"}),!u&&!d&&(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"mb-4",children:"Ready to score benchmarks against your Genie Space."}),(0,a.jsx)("button",{onClick:x,className:"bg-blue-600 text-white px-6 py-2 rounded hover:bg-blue-700",children:"Start Scoring"})]}),d&&(0,a.jsxs)("div",{className:"text-center py-8",children:[(0,a.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto mb-4"}),(0,a.jsx)("p",{children:"Scoring in progress..."})]}),u&&(0,a.jsxs)("div",{children:[(0,a.jsxs)("div",{className:"bg-green-100 p-6 rounded mb-4",children:[(0,a.jsxs)("h3",{className:"text-xl font-bold mb-2",children:["Score: ",(100*u.score).toFixed(1),"%"]}),(0,a.jsxs)("p",{children:["Passed: ",u.passed," / ",u.total]}),(0,a.jsxs)("p",{children:["Failed: ",u.failed]})]}),(0,a.jsxs)("div",{className:"flex justify-between",children:[(0,a.jsx)("button",{onClick:o,className:"bg-gray-300 text-gray-700 px-6 py-2 rounded hover:bg-gray-400",children:"← Back"}),(0,a.jsx)("button",{onClick:()=>{l()},className:"bg-blue-600 text-white px-6 py-2 rounded hover:bg-blue-700",children:"Next →"})]})]})]})}function i(e){let{state:s,onUpdate:t,onNext:l,onBack:o,sessionId:r}=e,[i,c]=(0,n.useState)(null),[d,h]=(0,n.useState)(null),[u,p]=(0,n.useState)(!1),[x,m]=(0,n.useState)(null),[b,j]=(0,n.useState)(!1),g=async()=>{p(!0);try{var e,t;let a=(null===(t=s.scoreResult)||void 0===t?void 0:null===(e=t.results)||void 0===e?void 0:e.filter(e=>!e.passed))||[],n=await fetch("/api/jobs/plan",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({session_id:r,workspace_config:{host:s.host,token:s.token,warehouse_id:s.warehouse_id,space_id:s.space_id,llm_endpoint:s.llm_endpoint},failed_benchmarks:a})}),l=await n.json();c(l.job_id),y(l.job_id)}catch(e){console.error("Failed to start planning:",e),p(!1)}},y=async e=>{let s=setInterval(async()=>{let t=await fetch("/api/jobs/".concat(e)),a=await t.json();"completed"===a.status?(clearInterval(s),m(a.result),p(!1)):"failed"===a.status&&(clearInterval(s),p(!1),alert("Planning failed: "+a.error))},2e3)},f=async()=>{p(!0);try{let e=await fetch("/api/jobs/apply",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({session_id:r,workspace_config:{host:s.host,token:s.token,warehouse_id:s.warehouse_id,space_id:s.space_id,llm_endpoint:s.llm_endpoint},grouped_fixes:x.grouped_fixes,dry_run:!1})}),t=await e.json();h(t.job_id),v(t.job_id)}catch(e){console.error("Failed to apply fixes:",e),p(!1)}},v=async e=>{let s=setInterval(async()=>{let a=await fetch("/api/jobs/".concat(e)),n=await a.json();"completed"===n.status?(clearInterval(s),j(!0),p(!1),t({appliedFixes:!0})):"failed"===n.status&&(clearInterval(s),p(!1),alert("Apply failed: "+n.error))},2e3)};return(0,a.jsxs)("div",{className:"space-y-6",children:[(0,a.jsx)("h2",{className:"text-2xl font-bold",children:"\uD83D\uDD27 Plan & Apply Enhancements"}),!x&&!u&&(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"mb-4",children:"Generate enhancement plan from failed benchmarks."}),(0,a.jsx)("button",{onClick:g,className:"bg-blue-600 text-white px-6 py-2 rounded hover:bg-blue-700",children:"Generate Plan"})]}),u&&(0,a.jsxs)("div",{className:"text-center py-8",children:[(0,a.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto mb-4"}),(0,a.jsx)("p",{children:b?"Applying fixes...":"Generating plan..."})]}),x&&!b&&(0,a.jsxs)("div",{children:[(0,a.jsxs)("div",{className:"bg-blue-100 p-6 rounded mb-4",children:[(0,a.jsx)("h3",{className:"text-xl font-bold mb-2",children:"Plan Ready"}),(0,a.jsxs)("p",{children:["Total fixes: ",x.total_fixes]})]}),(0,a.jsx)("button",{onClick:f,className:"bg-green-600 text-white px-6 py-2 rounded hover:bg-green-700",children:"Apply Fixes"})]}),b&&(0,a.jsxs)("div",{children:[(0,a.jsx)("div",{className:"bg-green-100 p-6 rounded mb-4",children:(0,a.jsx)("h3",{className:"text-xl font-bold mb-2",children:"✓ Fixes Applied"})}),(0,a.jsxs)("div",{className:"flex justify-between",children:[(0,a.jsx)("button",{onClick:o,className:"bg-gray-300 text-gray-700 px-6 py-2 rounded hover:bg-gray-400",children:"← Back"}),(0,a.jsx)("button",{onClick:l,className:"bg-blue-600 text-white px-6 py-2 rounded hover:bg-blue-700",children:"Next →"})]})]})]})}function c(e){let{state:s,onUpdate:t,onBack:l,sessionId:o}=e,[r,i]=(0,n.useState)(null),[c,d]=(0,n.useState)(!1),[h,u]=(0,n.useState)(null),p=async()=>{d(!0);try{var e;let t=await fetch("/api/jobs/validate",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({session_id:o,workspace_config:{host:s.host,token:s.token,warehouse_id:s.warehouse_id,space_id:s.space_id,llm_endpoint:s.llm_endpoint},benchmarks:s.benchmarks||[],initial_score:(null===(e=s.scoreResult)||void 0===e?void 0:e.score)||0,target_score:.9})}),a=await t.json();i(a.job_id),x(a.job_id)}catch(e){console.error("Failed to start validation:",e),d(!1)}},x=async e=>{let s=setInterval(async()=>{let t=await fetch("/api/jobs/".concat(e)),a=await t.json();"completed"===a.status?(clearInterval(s),u(a.result),d(!1)):"failed"===a.status&&(clearInterval(s),d(!1),alert("Validation failed: "+a.error))},2e3)};return(0,a.jsxs)("div",{className:"space-y-6",children:[(0,a.jsx)("h2",{className:"text-2xl font-bold",children:"✅ Validate Results"}),!h&&!c&&(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"mb-4",children:"Re-score benchmarks to validate improvements."}),(0,a.jsx)("button",{onClick:p,className:"bg-blue-600 text-white px-6 py-2 rounded hover:bg-blue-700",children:"Start Validation"})]}),c&&(0,a.jsxs)("div",{className:"text-center py-8",children:[(0,a.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto mb-4"}),(0,a.jsx)("p",{children:"Validating enhancements..."})]}),h&&(0,a.jsxs)("div",{children:[(0,a.jsxs)("div",{className:"p-6 rounded mb-4 ".concat(h.target_reached?"bg-green-100":"bg-yellow-100"),children:[(0,a.jsx)("h3",{className:"text-2xl font-bold mb-4",children:h.target_reached?"\uD83C\uDF89 Target Reached!":"\uD83D\uDCCA Results"}),(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsxs)("p",{children:[(0,a.jsx)("strong",{children:"Initial Score:"})," ",(100*h.initial_score).toFixed(1),"%"]}),(0,a.jsxs)("p",{children:[(0,a.jsx)("strong",{children:"New Score:"})," ",(100*h.new_score).toFixed(1),"%"]}),(0,a.jsxs)("p",{children:[(0,a.jsx)("strong",{children:"Improvement:"})," ",(100*h.improvement).toFixed(1),"%"]}),(0,a.jsxs)("p",{children:[(0,a.jsx)("strong",{children:"Target:"})," ",(100*h.target_score).toFixed(1),"%"]})]})]}),(0,a.jsxs)("div",{className:"flex justify-between",children:[(0,a.jsx)("button",{onClick:l,className:"bg-gray-300 text-gray-700 px-6 py-2 rounded hover:bg-gray-400",children:"← Back"}),(0,a.jsx)("button",{onClick:()=>window.location.reload(),className:"bg-blue-600 text-white px-6 py-2 rounded hover:bg-blue-700",children:"Start New Enhancement"})]})]})]})}function d(e){let{currentSessionId:s,onSessionChange:t}=e,[l,o]=(0,n.useState)([]),[r,i]=(0,n.useState)(!1),c=async()=>{i(!0);try{let e=await fetch("/api/sessions"),a=await e.json();o(a.sessions||[]),!s&&a.sessions.length>0&&t(a.sessions[0].session_id)}catch(e){console.error("Failed to load sessions:",e)}finally{i(!1)}},d=async()=>{try{let e=await fetch("/api/sessions/create",{method:"POST"}),s=await e.json();o([s,...l]),t(s.session_id)}catch(e){console.error("Failed to create session:",e)}};return(0,n.useEffect)(()=>{c()},[]),(0,a.jsxs)("div",{className:"w-64 bg-white border-r border-gray-200 p-4 overflow-y-auto",children:[(0,a.jsx)("div",{className:"mb-4",children:(0,a.jsx)("button",{onClick:d,className:"w-full bg-blue-600 text-white py-2 px-4 rounded hover:bg-blue-700",children:"+ New Session"})}),(0,a.jsx)("div",{className:"space-y-2",children:r?(0,a.jsx)("p",{className:"text-gray-500 text-sm",children:"Loading..."}):l.map(e=>(0,a.jsxs)("div",{onClick:()=>t(e.session_id),className:"\n                p-3 rounded cursor-pointer\n                ".concat(s===e.session_id?"bg-blue-100 border-blue-500":"bg-gray-50 hover:bg-gray-100","\n              "),children:[(0,a.jsx)("p",{className:"font-medium text-sm",children:e.name}),(0,a.jsx)("p",{className:"text-xs text-gray-500",children:e.updated_at})]},e.session_id))})]})}function h(){let[e,s]=(0,n.useState)(1),[t,h]=(0,n.useState)({}),[u,p]=(0,n.useState)(null),x=e=>{h(s=>({...s,...e}))};return(0,a.jsxs)("div",{className:"flex h-screen bg-gray-50",children:[(0,a.jsx)(d,{currentSessionId:u,onSessionChange:e=>{p(e),s(1),h({})}}),(0,a.jsx)("main",{className:"flex-1 overflow-y-auto",children:(0,a.jsxs)("div",{className:"max-w-6xl mx-auto p-8",children:[(0,a.jsxs)("header",{className:"mb-8",children:[(0,a.jsx)("h1",{className:"text-4xl font-bold text-gray-900 mb-2",children:"\uD83E\uDDDE Genie Space Enhancement"}),(0,a.jsx)("p",{className:"text-lg text-gray-600",children:"Automated improvement system with benchmark-driven evaluation"})]}),(0,a.jsx)("div",{className:"mb-8",children:(0,a.jsx)(l,{currentStep:e,steps:["Configure","Score","Plan & Apply","Validate"]})}),(0,a.jsxs)("div",{className:"bg-white rounded-lg shadow-lg p-6",children:[1===e&&(0,a.jsx)(o,{state:t,onUpdate:x,onNext:()=>s(2),sessionId:u}),2===e&&(0,a.jsx)(r,{state:t,onUpdate:x,onNext:()=>s(3),onBack:()=>s(1),sessionId:u}),3===e&&(0,a.jsx)(i,{state:t,onUpdate:x,onNext:()=>s(4),onBack:()=>s(2),sessionId:u}),4===e&&(0,a.jsx)(c,{state:t,onUpdate:x,onBack:()=>s(3),sessionId:u})]})]})})]})}}},function(e){e.O(0,[971,69,744],function(){return e(e.s=4529)}),_N_E=e.O()}]);